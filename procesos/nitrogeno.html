<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Huerto RA - Ciclo del Nitrógeno</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
    AFRAME.registerComponent('load-nitrogen-data', {
      init: function() {
        fetch('../especies.json')
          .then(response => response.json())
          .then(data => {
            const especies = data.huerto.especies;
            let textoNitrogeno = 'CICLO DEL NITROGENO\n\n';
            especies.forEach(especie => {
              textoNitrogeno += especie.nombre_comun + ':\n';
              textoNitrogeno += especie.ciclo_nitrogeno + '\n\n';
            });
            document.getElementById('info-nitrogeno').setAttribute('value', textoNitrogeno);
            const micro = data.huerto.procesos_microscopicos.bacterias_nitrogeno;
            document.getElementById('bacterias').setAttribute('value', 'Bacterias: ' + micro);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    });
    
    AFRAME.registerComponent('nitrogen-flow', {
      init: function() {
        this.tick = AFRAME.utils.throttleTick(this.tick, 50, this);
      },
      tick: function(time) {
        const oscillate = Math.sin(time / 1000) * 0.2;
        this.el.object3D.position.y = 0.5 + oscillate;
      }
    });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
      load-nitrogen-data
    >
      <a-marker preset="hiro">
        <!-- CONTENEDOR ROTADO PARA PANTALLA VERTICAL -->
        <a-entity rotation="-90 0 0" position="0 0 0">

          <!-- SUELO -->
          <a-box 
            position="0 0 0" 
            width="1.5" 
            height="0.2" 
            depth="1.5" 
            color="#8B4513"
            opacity="0.8"
          ></a-box>

          <!-- BACTERIAS ANIMADAS -->
          <a-sphere 
            position="-0.4 0.3 0" 
            radius="0.08" 
            color="#00ff00"
            nitrogen-flow
          ></a-sphere>
          <a-sphere 
            position="0.4 0.3 0" 
            radius="0.08" 
            color="#00ff00"
            nitrogen-flow
          ></a-sphere>
          <a-sphere 
            position="0 0.3 0.4" 
            radius="0.08" 
            color="#00ff00"
            nitrogen-flow
          ></a-sphere>

          <!-- FLECHAS DE FLUJO -->
          <a-cylinder
            position="-0.4 0.8 0"
            radius="0.02"
            height="0.5"
            color="#ffff00"
            opacity="0.7"
          ></a-cylinder>
          <a-cylinder
            position="0.4 0.8 0"
            radius="0.02"
            height="0.5"
            color="#ffff00"
            opacity="0.7"
          ></a-cylinder>

          <!-- RAÍCES -->
          <a-cylinder
            position="0 0.1 0"
            radius="0.03"
            height="0.3"
            color="#654321"
          ></a-cylinder>

          <!-- TEXTOS -->
          <a-text
            value="CICLO DEL NITROGENO"
            position="0 1.5 0"
            align="center"
            color="#ffffff"
            scale="0.7 0.7 0.7"
          ></a-text>

          <a-text
            id="bacterias"
            value="Cargando..."
            position="0 1.2 0"
            align="center"
            color="#00ff00"
            scale="0.45 0.45 0.45"
          ></a-text>

          <a-text
            id="info-nitrogeno"
            value="Cargando..."
            position="0 0.8 0"
            align="center"
            color="#ffffff"
            scale="0.4 0.4 0.4"
            wrap-count="35"
          ></a-text>

        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
